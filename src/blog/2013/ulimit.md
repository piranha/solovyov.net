title: Mac OS X: too many open files
date: 2013-01-21
tags: macos, gostatic
alternate: <link rel="alternate" hreflang="ru" href="https://solovyov.net/blog/2013/ulimit/" /> <link rel="alternate" hreflang="en" href="https://solovyov.net/blog/2013/macos-too-many-open-files/" />
----

Иногда на Макоси возникает такая ошибка, и я боролся с ней разными способами:
поднимал значения в `kern.maxfiles` и `kern.maxfilesperproc`, менял лимиты в
`launchctl limit` - и обычно это не помогало, но как-то всë же я проходил дальше
и всë работало.

Но тут стало невыносимо, запускаешь gostatic в режиме слежения за файлами, и при
изменении любого файла запуск внешней команды (в этом случае `lessc`) валился с
ошибкой `too many open files`. Сколько там тех too many, блин! Энивей, я только
что провëл 10 минут опять и теперь пишу пост, чтоб не пришлось делать этого еще
раз (и может кому-то из вас поможет).

Итак, солюшен. Я никогда не обращал внимания на `ulimit -n`, потому что он
всегда отвечал `unlimited`. Похоже, что это wishful thinking, никакого
отношения к реальности не имеет и лимит довольно небольшой, поэтому:

    ulimit -S -n 4096

помогло.

Для информации: проведенными позже экспериментами было установлено, что
максимальное количество файлов на 1 процесс - 249 включительно.
