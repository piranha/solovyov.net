date: 2023-02-22 11:49:53
uuid: 3c039761-e533-4553-9da7-5b728bfe3647
tgid: 249
tags: channel
----

<p>–Ø —Ç—ñ–∫–∏ —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤ ChatGPT –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –Ω–∞–ø–∏—Å–∞—Ç–∏ –ø–ª–∞–≥—ñ–Ω –¥–ª—è ProseMirror. –¶–µ –ø—Ä–æ—Å—Ç–æ —Å—é—Ä—Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π –¥–æ—Å–≤—ñ–¥.</p>

<p>–ü–ª–∞–≥—ñ–Ω ‚Äî —Ü–µ –∫–æ–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è. –ù–µ –ø–∏—Ç–∞–π—Ç–µ, –Ω–∞—â–æ –º–µ–Ω—ñ, —è–∫—â–æ –∑–∞—Ä–∞–∑ –≤—Å–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∑—Ä–æ—â—É, —Ç–æ –ø–æ–∫–∞–∂—É —Å–∫–æ—Ä–æ. :)</p>

<p>–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è —Ç–∞–∫: —è –Ω–∞–ø–∏—Å–∞–≤ —Å–∞–º –ø–µ—Ä—à—É –≤–µ—Ä—Å—ñ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≥—É–≥–ª—É, —ñ—Å–Ω—É—é—á–∏—Ö –ø—Ä–∏–∫–ª–∞–¥—ñ–≤, –æ–±–≥–æ–≤–æ—Ä–µ–Ω—å –Ω–∞ —Ñ–æ—Ä—É–º–∞—Ö ‚Äî –Ω—É –≤—Å–µ —è–∫ –∑–≤–∏—á–∞–π–Ω–æ. –Ü –∑—Ä–æ–∑—É–º—ñ–≤, —â–æ –ø—ñ–¥—Ö—ñ–¥ –¥—É–∂–µ –ø—Ä–∏–≤–∞–±–ª–∏–≤–∏–π, –∞–ª–µ –≤ —Å–ø—ñ–ª—å–Ω–æ–º—É (collaborative) —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ –≤—Å–µ –ª–∞–º–∞—î—Ç—å—Å—è. –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –¥–æ–∫—É–º–µ–Ω—Ç—É —ñ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑—É–≤–∞—Ç–∏ —ó—Ö ‚Äî –≥–µ–º–æ—Ä.</p>

<p>–ó—Ä–∞–Ω–∫—É –ø–æ–¥–∏–≤–∏–≤—Å—è –Ω–∞ Notion, –∞ –≤–æ–Ω–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å —É –≤–µ—Ä—Å—Ç—Ü—ñ –Ω–∞–∑–∞–≤–∂–¥–∏, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —ó—Ö –∑–∞—Ä–µ–∑–æ–ª–≤–∏–ª–∏. –ù—É, –¥—É–º–∞—é, —Å—É–ø–µ—Ä, –∑—Ä–æ–±–∏–≤ —è–∫—É—Å—å –ø–µ—Ä—à—É –≤–µ—Ä—Å—ñ—é —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –ø–æ –ø—Ä–∏–∫–ª–∞–¥–∞—Ö, –≤–æ–Ω–∞ –ø—Ä–∞—Ü—é—î, –∞–ª–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ API (<code>setMark</code>) –ø—Ä–æ—Å—Ç–æ –∑–∞—Ç–∏—Ä–∞—î —ñ—Å–Ω—É—é—á—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ. –ù—É –º–æ–∂–Ω–∞ –±—É–ª–æ –± —Ü–µ –æ—á—ñ–∫—É–≤–∞—Ç–∏.</p>

<p>–Ø —Å–æ–±—ñ –ø–æ–¥—É–º–∞–≤, —â–æ —Ç—Ä–µ–±–∞ –∑—ñ–±—Ä–∞—Ç–∏ –≤–∂–µ —ñ—Å–Ω—É—é—á—ñ –º—ñ—Ç–∫–∏ (mark ‚Äî —Ü–µ —Ç–µ—Ä–º—ñ–Ω–æ–ª–æ–≥—ñ—è ProseMirror&#39;–∞ –¥–ª—è —Ä–æ–∑–º—ñ—Ç–∫–∏ —Ç–µ–∫—Å—Ç—É), —ñ —Ä—É–∫–∞–º–∏ –∑–º–µ—Ä–∂–∏—Ç–∏, –¥–µ —Ç—Ä–µ–±–∞. –¢–∏–ø—É —î –º—ñ—Ç–∫–∞ —Ç–∞–∫–æ–≥–æ —Ç–∏–ø—É ‚Äî –æ–±&#39;—î–¥–Ω—É—é, –Ω–µ–º–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞–≤–ª—é.</p>

<p>–ü—ñ—à–æ–≤ —á–∏—Ç–∞—Ç–∏ API –ø—Ä–æ—É–∑–º—ñ—Ä—Ä–æ—Ä–∞, –∞ –≤–æ–Ω–æ –≤–µ–ª–∏—á–µ–∑–Ω–µ —ñ —è –Ω–µ –¥—É–∂–µ –π–æ–≥–æ —à–∞—Ä—é. –ü—ñ–¥—É, –¥—É–º–∞—é, —Å–ø–∏—Ç–∞—é –≤ ChatGPT, —Ü—ñ–∫–∞–≤–æ —â–æ –≤—ñ–Ω –∑—Ä–æ–±–∏—Ç—å. –°–ø–∏—Ç–∞–≤ —è–∫ –∑–Ω–∞–π—Ç–∏ –≤—Å—ñ –º—ñ—Ç–∫–∏ —è–∫–æ–≥–æ—Å—å —Ç–∏–ø—É, —Å–ø–∏—Ç–∞–≤ —è–∫ —ó—Ö –ø–æ–∑–∏—Ü—ñ—ó –∑–Ω–∞–π—Ç–∏, –∞ –ø–æ—Ç—ñ–º –¥—É–º–∞—é ‚Äî –Ω—É –¥–æ —á–æ–≥–æ –æ—Ü—ñ –≤—Å—ñ –ø–æ–ª—É–º—ñ—Ä–∏? –ü–∏—Ç–∞—é:</p>

<blockquote><p>
How would I add mark of some type (say <code>comment</code>) to a selection in ProseMirror, appending some identifier if such mark already is set on a part of selection, rather than replacing it?
</p></blockquote>

<p>–ù–µ —Ç–∞–∫ —â–æ–± –∑–∞–±–∞–≥–∞—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É, –¥–∞? –ù—É —ñ –≤—ñ–Ω –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î, –∑ –ø–æ—è—Å–Ω–µ–Ω–Ω—è–º–∏, –≤—Å–µ —Ç–∞–∫–µ, –∞–ª–µ –∑–º—ñ—Å—Ç –∑–≤–æ–¥–∏—Ç—å—Å—è –¥–æ –æ—Ü—å–æ–≥–æ —à–º–∞—Ç–æ—á–∫—É –∫–æ–¥–∞:</p>

<pre><code class="language-go">// update the document state with the new mark
const tr = editor.state.tr.addMark(start, end, commentMark);

// preserve any existing comment marks in the selection
doc.nodesBetween(start, end, (node, pos) =&gt; {
  const commentMarks = node.marks.filter((mark) =&gt; mark.type.name === &#39;comment&#39;);
  for (const mark of commentMarks) {
    if (!mark.attrs.id.includes(uniqueId)) {
      tr.addMark(pos, pos + node.nodeSize, mark);
    }
  }
});
</code></pre>

<p>–Ø–∫—â–æ –≤—á–∏—Ç–∞—Ç–∏—Å—è, —Ç–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ä—è–¥–æ–∫ –∫–æ–¥—É ‚Äî –≤—ñ–Ω —ó—Ö –Ω–µ –æ–±&#39;—î–¥–Ω—É—î, –∞ –ø—Ä–æ—Å—Ç–æ –∑–±–µ—Ä—ñ–≥–∞—î —Å—Ç–∞—Ä—ñ. –ê–ª–µ –Ω—É —è–∫—ñ –ø—Ä–æ–±–ª–µ–º–∏, —Ü–µ –≤–∂–µ –æ–¥–∏–Ω if&#39;—á–∏–∫ –¥–ª—è –º–µ–Ω–µ, —ñ —è –π–æ–≥–æ –Ω–∞–ø–∏—Å–∞–≤.</p>

<p>–Ü —à–æ –≤–∏ –¥—É–º–∞—î—Ç–µ? –ü—Ä–∞—Ü—é—î!</p>

<p>–î–∏–≤–Ω—ñ –≤—ñ–¥—á—É—Ç—Ç—è –∑ —Ç–æ–≥–æ –ø—Ä–∏–≤–æ–¥—É, –Ω–µ –º–æ–∂—É –∑—Ñ–æ—Ä–º—É–ª—é–≤–∞—Ç–∏. –ö–æ–¥ –¥–æ–≤–æ–ª—ñ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π, –∑–¥–∞—î—Ç—å—Å—è. –ö—Ä—É—Ç–æ, –∫—Ä—É—Ç–æ. –í–∏—Å–ª–æ–≤–ª—é–π—Ç–µ —Å–≤–æ—ó –¥—É–º–∫–∏. üòÅ</p>

<p><strong>UPD.</strong> –ü–æ—Ö–æ–¥–∏–≤ —Ç—É—Ç, –ø–æ–¥—É–º–∞–≤:</p>

<ol>
	<li>–í –¥–µ—Ç–∞–ª—è—Ö –≤–æ–Ω–æ –ø—Ä–æ–≤—Ç–∏–∫—É—î. –£ —Å–µ–Ω—Å—ñ —â–æ —è –ø–µ—Ä–µ–ø–∏—Å–∞–≤ –º–∞–π–∂–µ —É–≤–µ—Å—å –∫–æ–¥, —â–æ –≤–æ–Ω–æ –∑–≥–µ–Ω–µ—Ä—É–≤–∞–ª–æ. –ù—É –º–∏ –π —Ç–∞–∫ –≤–∂–µ –≤—Å—ñ –∑–Ω–∞—î–º–æ, —â–æ ML ‚Äî —Ü–µ –Ω–µ –ø—Ä–æ —Ç–µ, –∫–æ–ª–∏ —Ç–æ–±—ñ –≤–∞–∂–ª–∏–≤—ñ –¥–µ—Ç–∞–ª—ñ.</li>
	<li>–ê–ª–µ –æ—Å–Ω–æ–≤–Ω—ñ –º–æ–º–µ–Ω—Ç–∏ ‚Äî <code>doc.nodesBetween</code>, <code>node.marks</code> —Ç–∞ <code>tr.addMark</code> ‚Äî —Ü–µ —ñ —î –≥–æ–ª–æ–≤–Ω–∞ –∫–æ—Ä–∏—Å—Ç—å. –ù–∞–ø–µ–≤–Ω–æ –¥–µ—Å—å –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ —î –æ—Ü—è –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è, –∞–ª–µ –∑–Ω–∞–π—Ç–∏ –ø–æ—à—É–∫–æ–º –º–µ–Ω—ñ —ó—ó –Ω–µ –≤–¥–∞–ª–æ—Å—è. –Ø —Ç–æ–º—É —ñ –ø—ñ—à–æ–≤ —Å–ø–æ—á–∞—Ç–∫—É —ñ–Ω—à–∏–π —Å–ø–æ—Å—ñ–± —Ä–µ–∞–ª—ñ–∑–æ–≤—É–≤–∞—Ç–∏, –±–æ —ñ–¥–µ–π, —â–æ —Ä–æ–±–∏—Ç–∏ –∑ –º—ñ—Ç–∫–∞–º–∏ ‚Äî –Ω–µ –±—É–ª–æ.</li>
	<li>–ë–µ–∑ –º–æ–≥–æ —Ä–æ–∑—É–º—ñ–Ω–Ω—è, —â–æ —Ä–æ–±–∏—Ç–∏, –∑ –Ω–µ—á—ñ—Ç–∫–∏–º–∏ –∑–∞–ø–∏—Ç–∞–º–∏ ‚Äî –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–¥ —Ç–µ–∂ –±—É–≤ —Ñ—É—Ñ–ª–æ–º –±–µ–∑–∑–º—ñ—Å—Ç–æ–≤–Ω–∏–º. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ –ø–æ—Ç—Ä—ñ–±–Ω–∞, –∫–æ—Ä–æ—á–µ. –¢–∞ —Å–∞–º–∞ —ñ—Å—Ç–æ—Ä—ñ—è, —â–æ –∑ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è–º: –≤—ñ–¥ —ñ–¥–µ—ó –¥–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—Ä—ñ—Ä–≤–∞ —Ä–æ–±–æ—Ç–∏. –ê ChatGPT —Ç—É—Ç –¥–æ–ø–æ–º–∞–≥–∞—î —á–∞—Å—Ç–∏–Ω–∫—É –ø—Ä—ñ—Ä–≤–∏ –∑–∞—Å–∏–ø–∞—Ç–∏.</li>
</ol>

<p>–ù–∞–ø–µ–≤–Ω–æ, —è excited –∑ –ø—Ä–∏–≤–æ–¥—É —Ç–æ–≥–æ, –∫—É–¥–∏ —Ä—É—Ö–∞—î—Ç—å—Å—è –ø—Ä–æ—Ñ–µ—Å—ñ—è. –î—É–º–∞—Ç–∏ –Ω–∞–¥ —ñ–¥–µ—è–º–∏ –º–µ–Ω—ñ –ø–æ–¥–æ–±–∞—î—Ç—å—Å—è –±—ñ–ª—å—à–µ, –Ω—ñ–∂ –¥–æ–ª–±–∞—Ç–∏—Å—è –∑ —Ä–æ–∑–±–∏—Ä–∞–Ω–Ω—è–º, —è–∫–∏–π –∞–ø—ñ —è–∫ —Ç—Ä–µ–±–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏. üòÅ</p>