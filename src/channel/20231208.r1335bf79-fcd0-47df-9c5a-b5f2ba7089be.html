date: 2023-12-08 16:40:49
uuid: r1335bf79-fcd0-47df-9c5a-b5f2ba7089be
tgid: 342
tags: channel
----

<p>zip та gzip обидва використовують алгоритм Deflate для стиснення файлів. Уявіть моє здивування, коли я сьогодні отримав <code>.tgz</code> на 165 кілобайт і <code>.zip</code> на 1.5 мегабайта. Подумав над причинами, знайшов що у поставці Мака є <code>zipinfo</code>, і зацініть що мені каже <code>zipinfo -v dump.zip</code>:</p><blockquote><p>The central directory is 376417 (000000000005BE61h) bytes long</p></blockquote><p>Точно! Чим <code>.tar</code> менш зручний, аніж <code>.zip</code> - в нього немає центрального списку файлів, і тому для пошуку одного файлу треба перебирати архів повністю. Але коли в твоєму архіві 3 тисячі файлів — це грає на руку, немає оцих окремих 376 кб списку файлів. Ну добре, а куди ще мегабайт подівся?</p><p>Це вже очевидно — заради того, щоб можна було швиденько один файл у <code>.zip</code> знайти, кожен з цих файлів стиснений окремо. А <code>.tgz</code>, очевидно, спочатку зібраний таром, а потім вже стиснений гзіпом — і коли ці файли дуже схожі (наприклад, це купа yaml-файлів, де ключі між собою дуже схожі), то це прям капець яку різницю дає. Я навіть перевірив, зробив <code>.tar.zip</code>, і все зійшлося:</p><pre class="hljs"><code>&gt; ls -l --no-user --no-time --no-permissions dump.*
 89k dump.tar.bz2
100k dump.tar.xz
165k dump.tar.zip
165k dump.tgz
1.5M dump.zip</code></pre><p>Мораль: підстава приходить звідки не чекаєш.</p>