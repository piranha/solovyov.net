date: 2021-11-28 12:33:09
tgid: 100
----

<figure><img src="https://images.solovyov.net/images/r/2021/11/DraggedImage.png"/><figcaption></figcaption></figure>
<p>Давайте трохи за результати Black Friday розповім. Значить, перший раз, коли ми пережили її у 2016 році, в нас було 2.5k RPS (запитів у секунду) в API, десь 80 тисяч товарів і мінімум серверного рендерінгу.</p>

<p>Цього року близько мільйона товарів, 130 відрендерених сторінок в секунду (більша частина клієнтів — це мобільні аппки, які тільки апі торкаються) і близько 6k RPS.⚡️ Це насправді прикольний результат, враховуючи, що з заліза, де це все живе, в нас реально тільки сервер Постгресу новий (минулий був 15-го року за 10к баксів, а цей 20-го року теж за 10к баксів).</p>

<p>Єдине, що пішло трохи не по плану, так це ElasticSearch — хто б сумнівався, інтроспекції у те, як для нього розраховувати навантаження, дуже мало. В нього є &quot;explain&quot;, але його результат ну дуже важко інтерпретувати.</p>

<p>Я дивився у співвідношення <a href="https://en.wikipedia.org/wiki/Load_(computing)#Unix-style_load_calculation">LA</a> нод ES і навантаження на сервіс в цілому, і воно виглядало майже пов&#39;язаним лінійно — типу подвоєння RPS подвоює навантаження на ES. Але зранку минулої п&#39;ятниці (19 листопаду, на початку розпродажу) замість трохи підрости, LA злетів у небеса й еластіки почали гальмувати. Це означає що всі списки товарів туплять і людям важко купляти — у сенсі вони просто пішли собі займатися іншими справами. :(</p>

<p>Ми за годину наколупали з 5 додаткових нод еластіку, а за наступний тиждень взяли в оренду ще заліза, щоб побудувати додатковий кластер еластіку і раунд-робіном на них розкинули навантаження. Тож п&#39;ятниця 26-го була нудною. Чого, власне, ми й прагнули. ☺️</p>