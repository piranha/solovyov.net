title: Ефективність сервісу
date: 2022-11-25 17:42:22
uuid: 9c4a3474-214a-4966-b6ec-90ea54891947
tgid: 214
tags: channel, preview
----

<p>Колись існувала мантра про те, що програмісти значно дорожчі за залізо, і не треба думати про залізо. Але в якийсь момент, особливо для бізнесів, де багато безоплатного навантаження (наприклад, для Твіттера) — це стає болісно. І от один екс-твіп (tweep — так кличуть себе працівники Твіттера) пише, <a href="https://twitter.com/petrillic/status/1593686223717269504">чому ж вони сиділи на власному залізі</a>: бо потреби Твіттера у 500 тисяч серверів виходить занадто дорого навіть з величезними знижками! Типу 300 мільйонів доларів на місяць.</p>

<p>Напевно всі їх робітники коштують дорожче (навіть якщо взяти медіану в 100k з прибиральницями, то на 7000 це 700 млн), але це той самий порядок грошей!</p>

<p>Так от, мене якось дуже вразила кількість у <strong>500 тисяч</strong> серверів, і я пішов копатися. Наче у 2 кварталі 22 року DAU (це daily active users) у Твіттера було 237 млн людей. Це виходить всього лише 500 людей на сервер?!</p>

<p>Так-так, я розумію, що там не тільки сервера, які обслуговують людей, це і всілякі сховища даних, аналітичні приблуди, он там чувак згадує кластер Presto на 1000 нод.</p>

<p>Але в Касті — вибачте, не буду розкривати цифри, бо вони вже якби не мої — ефективність виходить приблизно в 30 раз вище. Навіть якщо я помиляюся з оцінками кількості серверів, то це в 10-20 разів більше народу на 1 сервер. Це теж включно з усілякими серверами для аналітики, еластіксьорчі для пошуку і для логів (окремо) тощо.</p>

<p>Але є ще цікаві моменти:</p>

<ul>
	<li>Так, Каста технічно — непогана, але не неймовірна: мені здається, що за останні 3 роки сервіс сповільнився десь у 2-3 рази. Стало більше можливостей, коду, даних, десь якісь оптимізації провтикалися. Я думаю що за 2-3 місяці сфокусованої роботи (і може переходу на веспу ггг) можна було б повернути частково.</li>
	<li>Сервери Касти — це типу 4-8 ядер і 64-128 Гб оперативки. <code>m6dg.12xlarge</code>, яких треба 500 тищ — це 48 ядер і 192 Гб оперативки. Просто інший рівень взагалі.</li>
	<li>Що складніше, Каста чи Твіттер? Мені здається, що при інших рівних 1 користувач єкомерса створює більше навантаження. Тим чесніше це порівняння.</li>
</ul>

<p>Тобто реальна різниця між тим що є і тим що має бути мінімум два порядки. Що робили всі ті тисячі програмістів?.. Невже ніхто не хотів зекономити грошей на чергову тисячу додаткових програмістів — і отримати якийсь цікавий бонус у процесі?</p>

<p>Ден Луу написав тред, який же <a href="https://twitter.com/danluu/status/1592774269733601281">Твіттер технологічно офігенний</a>. Але мені здається, що ця метрика, хоч і недосконала, але при такій різниці це вже показник. А інженери у Твіттері просто розважалися, а не робили щось корисне. Фу на них.</p>