date: 2023-05-31 16:06:34
uuid: r70ca02dd-86c2-4ced-b7ad-ecf3f4d6bfbb
tgid: 284
tags: channel
----

<p>На HN обговорюють, як <a target="_blank" rel="noopener noreferrer nofollow" href="https://news.ycombinator.com/item?id=36113430">прискорили завантаження Вікіпедії на 300 мс</a>. Якщо вам ліньки читати, то коротка версія така: там код на жсі пробігався по купі елементів, щоби навісити хендлери — і цей цикл виходив дуже довгим. В одному випадку вдалося просто видалити код, в іншому замінити на делегацію подій.</p><p>Але поговорити мені хочеться за інше: частина обговорення пішла про те, що Вікіпедія (та й сам HN) швидше грузяться для анонимів, аніж для залогінених користувачів. Бо анонімам віддається кешована сторінка, а для користувача треба відрендерити персональну сторіночку. Бо там ім’я користувача є, всіляки лайки/апвоти, ну короч, все як завжди.</p><p>З однієї сторони, хочеться, щоб всі були залогінені. З іншої — воно ж додаткового навантаження генерує немало. Неприємно, так?</p><p>Є кльовий підхід: віддавати <em>всім</em> версію для анонімних користувачів, а потім, коли вже все завантажилося, всілякі LCP пройшли і користувач дивиться на сайт, догружати кастомізації для залогіненого користувача. Це, очевидно, потребує деяких жертв — щоби верстка була схожа і не було зсувів та значних візуальних змін, щоби основний контент не залежав від користувача… Але якщо ці умови виконати, то відкривається дивний світ різкого зниження навантаження на сервер. :)</p><p>На Касті таким чином підгружаються хедер і вподобайки на товарах, і ніхто того взагалі не палить. :)</p>